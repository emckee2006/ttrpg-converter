# M3.2: Mapping Architecture and Conventions

**Author:** Gemini & Alithanna
**Date:** 2024-07-26
**Status:** Adopted & Implemented

## 1. Overview

As the project scales to support multiple source and destination systems (Roll20, Foundry, Pathbuilder) and multiple game systems (D&D 5e, Pathfinder 1e/2e), a robust and scalable organization for our mapping logic is critical. This document defines the official directory structure, file naming conventions, and namespace conventions for all AutoMapper profiles and resolvers.

Adherence to these conventions is mandatory to ensure the codebase remains clear, maintainable, and easily extensible.

## 2. The Core Problem

A flat directory structure for all mapping files (e.g., `src/TTRPGConverter.Core/Mapping/`) is not sustainable. It quickly becomes difficult to locate specific mappings, understand their purpose, and manage the growing number of files. This lack of organization would hinder future development and make maintenance a significant challenge.

## 3. Directory Structure

The `src/TTRPGConverter.Core/Mapping/` directory will be organized using a `SourceToDestination/System` hierarchy. This provides a clear and intuitive structure for all conversion logic.

```
src/TTRPGConverter.Core/Mapping/
├── Roll20ToFoundry/
│   ├── Dnd5e/
│   │   ├── Profiles/
│   │   └── Resolvers/
│   ├── Pf2e/
│   │   ├── Profiles/
│   │   └── Resolvers/
│   └── Common/
│       ├── Profiles/
│       └── Resolvers/
├── FoundryToFoundry/
│   └── Dnd5eToPf2e/
│       ├── Profiles/
│       └── Resolvers/
└── FoundryToPathbuilder/
    └── Pf2e/
        ├── Profiles/
        └── Resolvers/
```

- **Top-Level Folders:** Define the major conversion types (e.g., `Roll20ToFoundry`).
- **System-Specific Folders:** Inside each conversion type, a folder for each target system (e.g., `Dnd5e`, `Pf2e`) will isolate system-specific logic.
- **The `Common` Folder:** This special folder will contain profiles and resolvers for mappings that are identical across all game systems (e.g., Rollable Tables, Macros). This is crucial for code reuse.
- **`Profiles` and `Resolvers`:** Within each system folder, `Profile` classes and their `Resolver` helpers will be kept in separate, dedicated directories.

## 4. File Naming Conventions

All mapping-related files must adhere to the following naming convention:

**`[SourceEntity]To[DestinationEntity][Profile|Resolver].cs`**

This convention is explicit, predictable, and makes it easy to identify the purpose of any file at a glance.

**Examples:**
- `CharacterToActorProfile.cs`
- `JournalPagesResolver.cs`
- `Roll20PathToFoundryWallProfile.cs`

## 5. Namespace Conventions

Namespaces must mirror the directory structure precisely. This provides logical organization and helps prevent type collisions.

**Example:**
The `CharacterToActorProfile.cs` file, when moved to its new location, will have the following namespace:

`namespace TTRPGConverter.Core.Mapping.Roll20ToFoundry.Dnd5e.Profiles;`

This structured approach will ensure that our mapping logic remains organized and maintainable as the project grows in complexity.
